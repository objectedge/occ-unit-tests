define("paginated",["knockout","pubsub"],function(t,e){"use strict";function i(){this.defaultSort="displayName",this.targetPage=1,this.clearOnLoad=!1,this.itemsPerPage=40,this.blockSize=40,this.pageBatchSize=1,this.data=t.observableArray(),this.pageWindowSize=5,this.startIndex=0,this.lastIndex=this.pageWindowSize-1,this.pageIndex=0,this.middlePageOffset=0,this.focusPage=!1,this.paginationId="cc-productlist-pagination",this.sortOptions=t.observableArray([]),this.currentPage=t.observable(0),this.totalNumber=t.observable(0),this.data=t.observableArray([]),this.sortDirectiveProp=t.observable("displayName"),this.sortDirectiveOrder=t.observable("asc"),this.totalNumberOfPages=t.observable(0),this.pageStartIndex=t.observable(),this.pageEndIndex=t.observable(),this.clickedPage=t.observable(-1),this.pages=t.computed(this.pagesFunction,this),this.scrollToTop=!0,this.currentPage(1),this.totalNumber(0),this.sortDirectiveProp(this.defaultSort),this.sortDirectiveOrder("asc"),this.totalNumberOfPages(0),this.clickedPage(-1)}return i.prototype.sort=function(t){var e,i,s;this.sortDirectiveOrder(),t.order();if(!t.notReversible||this.sortDirectiveOrder()!=t.order()){for(t.maintainSortOrder&&t.maintainSortOrder===!0?i=t.order():t.id&&(i="none"===t.order()||"desc"===t.order()?"asc":"desc"),this.sortDirectiveOrder(i),e=0;e<this.sortOptions().length;e+=1)this.sortOptions()[e]===t?this.sortOptions()[e].order(i):this.sortOptions()[e].maintainSortOrder||this.sortOptions()[e].order("none");if(this.sortDirectiveProp(t.id),this.data().length<this.totalNumber()||t.serverOnly)return this.clearOnLoad=!0,this.targetPage=1,void this.fetchBlock(0);if($.each(this.data(),function(t,e){if(!e)return s=!0,!1}),s)return this.clearOnLoad=!0,this.targetPage=1,void this.fetchBlock(0);this.data.sort(this.sortFunction.bind(this)),this.getPage(1)}},i.prototype.sortFunction=function(t,e){var i,s,a,r,o;for(o="desc"===this.sortDirectiveOrder()?-1:1,i=this.sortDirectiveProp()&&this.sortDirectiveProp().split("."),a=t,r=e,s=0;s<i.length;s+=1)$.isArray(a)&&(a=a[0]),$.isArray(a)&&(a=a[0]),a=a&&a[i[s]],$.isArray(r)&&(r=r[0]),r=r&&r[i[s]],$.isArray(r)&&(r=r[0]);return(a===r||"string"==typeof a&&a.toLowerCase()===r.toLowerCase())&&(t.displayName&&e.displayName?(a=t.displayName&&t.displayName.toString().toLowerCase(),r=e.displayName&&e.displayName.toString().toLowerCase()):t.dateTime&&e.dateTime&&(a=t.dateTime&&t.dateTime.toLowerCase(),r=e.dateTime&&e.dateTime.toLowerCase(),o=1)),a===r?0:isFinite(a)&&isFinite(r)?(parseFloat(a)-parseFloat(r))*o:a.toString().toLowerCase()>r.toString().toLowerCase()?o:-1*o},i.prototype.pagesFunction=function(){var t,e,i,s,a,r,o,h,n,d=1;for(this.clearOnLoad&&(this.startIndex=0,this.lastIndex=4,this.adjustStartAndEndPageIndex(1)),this.totalNumber()?(e=(this.totalNumber()-this.totalNumber()%this.itemsPerPage)/this.itemsPerPage,i=this.totalNumber()%this.itemsPerPage>0?1:0,t=e+i):t=0,this.prevTotalNumberOfPages=this.totalNumberOfPages(),this.totalNumberOfPages(t),s=[],h=this.startIndex;h<=this.lastIndex&&h<this.totalNumberOfPages();h+=1)a=h+1,r=a===this.currentPage(),o=!!this.focusPage&&r,n=Math.abs(a-h-d),d+=1,s[n]={pageNumber:a,selected:r,focused:o};return!this.focusPage&&s.length>0&&(this.focusPage=!0),s},i.prototype.adjustPageIndex=function(t){var e,i,s=Math.floor(this.pageWindowSize/2);t>=this.totalNumberOfPages()?t>this.totalNumberOfPages()?t=this.totalNumberOfPages():(this.lastIndex=this.totalNumberOfPages()-1,this.lastIndex-this.startIndex>this.pageWindowSize-1&&(this.startIndex=this.lastIndex-(this.pageWindowSize-1))):this.lastIndex+1===t?(this.lastIndex+2===this.totalNumberOfPages()?this.startIndex=this.lastIndex-s-1>=0?this.lastIndex-s-1:0:this.startIndex=this.lastIndex-s>=0?this.lastIndex-s:0,this.lastIndex=this.lastIndex+s<this.totalNumberOfPages()?this.lastIndex+s:this.totalNumberOfPages()):0!==this.startIndex&&this.startIndex+1==t?(i=this.startIndex,this.startIndex=this.startIndex-s>0?this.startIndex-s:0,e=this.totalNumberOfPages()-(this.startIndex+this.pageWindowSize-1),this.lastIndex=e>=0?this.startIndex+this.pageWindowSize-1:this.totalNumberOfPages()):this.prevTotalNumberOfPages!=this.totalNumberOfPages()&&this.totalNumberOfPages()-this.targetPage<this.pageWindowSize&&(this.lastIndex=this.totalNumberOfPages()-1,this.startIndex=this.lastIndex-this.pageWindowSize>=0?this.lastIndex-this.pageWindowSize:this.startIndex)},i.prototype.adjustStartAndEndPageIndex=function(t){this.pageEndIndex(t*this.itemsPerPage),this.totalNumber()&&this.pageEndIndex()>this.totalNumber()&&this.pageEndIndex(this.totalNumber()),this.pageStartIndex((t-1)*this.itemsPerPage)},i.prototype.initializeIndex=function(){this.startIndex=0,this.lastIndex=this.pageWindowSize-1,this.clickedPage(1)},i.prototype.getPage=function(t){var i;setTimeout(function(){$.Topic(e.topicNames.PAGINATION_PAGE_CHANGE).publish()},0);if(t!==this.currentPage()&&t!==this.targetPage&&$.Topic(e.topicNames.RECORD_PAGINATION_PAGE_CHANGE).publish(),this.clickedPage(t),this.totalNumberOfPages()>1&&this.adjustPageIndex(t),this.adjustStartAndEndPageIndex(t),t!==this.currentPage()&&(this.targetPage=t),this.clearOnLoad)return t!==this.currentPage()&&(this.targetPage=t),this.fetchBlock(this.pageStartIndex()),void this.clickedPage(t);for(i=this.pageStartIndex();i<this.pageEndIndex();i+=1)if("undefined"==typeof this.data()[i])return t!==this.currentPage()&&(this.targetPage=t),void this.fetchBlock(this.pageStartIndex());this.currentPage(t)},i.prototype.getFirstPage=function(){this.initializeIndex(),this.getPage(1)},i.prototype.getLastPage=function(){this.getPage(this.totalNumberOfPages())},i.prototype.changePage=function(t){this.getPage(t.pageNumber)},i.prototype.decrementPage=function(){this.currentPage()>this.startIndex+1&&this.getPage(this.currentPage()-1)},i.prototype.incrementPage=function(){this.currentPage()<this.totalNumberOfPages()&&this.getPage(this.currentPage()+1)},i.prototype.clearData=function(){this.data([]),this.prevTotalNumber=this.totalNumber(),this.totalNumber(null)},i.prototype.addData=function(t,e,i){var s,a,r;if(this.pageStartIndex()>0&&(e<0||e===i)?(e=this.prevTotalNumber-this.blockSize>=0?this.prevTotalNumber-this.blockSize:0,this.removeLastPage()):e=e<0?0:e,this.totalNumber(e),a=i+this.blockSize*this.pageBatchSize,a>e&&(a=e),this.clearOnLoad?(s=[],this.initializeIndex()):s=this.data(),t)for(r=0;r<t.length;r+=1)s[r+i]=t[r];this.clearOnLoad?(this.data(s),this.clearOnLoad=!1):this.data.valueHasMutated(),this.targetPage?(1==this.targetPage&&this.initializeIndex(),this.adjustStartAndEndPageIndex(this.targetPage),this.scrollToTop===!0&&$(window).scrollTop(0),this.currentPage(this.targetPage),this.scrollToTop===!0&&$(window).scrollTop(0),this.targetPage=null):a<this.pageEndIndex()&&this.pageEndIndex(a)},i.prototype.fetchBlock=function(t){throw"Function Not Implemented!"},i.prototype.load=function(t,e){t?this.clearOnLoad=!0:(this.clearData(),e&&(this.totalNumberOfPages(e),this.currentPage(e))),this.getPage(e||this.currentPage()||1)},i.prototype.removeLastPage=function(){this.clearOnLoad=!1,this.startIndex=this.startIndex-1>=0?this.startIndex-1:this.startIndex,this.getPage(this.currentPage()-1)},i.prototype.sortReset=function(){this.sortDirectiveProp(this.defaultSort),this.sortDirectiveOrder("asc"),$.each(this.sortOptions(),function(t,e){e.id===this.defaultSort?e.order("asc"):e.order("none")})},i});
//# sourceMappingURL=paginated.js.map