define(["ccConstants","jquery","pubsub","notifications","CCi18n"],function(e,t,n,c,i){"use strict";function o(o){var s=!0,u=null,r=e.TOKEN_WARNING_TIMEOUT,a=null,l=null,m=null,f="cc-warn-session-timeout-alert",E="cc-expire-session-alert",p=function(){t.Topic(n.topicNames.USER_SESSION_VALID).publish(),o.storeRequestWasMade=!1,s=!1,N()},T=function(){var t=function(e){};o.loggedIn&&(s||o.storeRequestWasMade)&&o.refresh(function(t){var n=t.expires_in;if(n){var c=1e3*n-e.TOKEN_EXPIRED_MESSAGE_TIMEOUT;r=Math.max(c,e.TOKEN_REFRESH_INTERVAL+1e4)}p()},t)},_=function(){o.loggedIn&&null==u&&(u=setInterval(T,e.TOKEN_REFRESH_INTERVAL))},d=function(){u&&(clearInterval(u),u=null)},I=function(){if(m=t(document.activeElement),m.is("iframe"))try{m=t(document.activeElement.contentWindow.document.activeElement)}catch(e){}},b=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&0==t(".cc-notification").length&&(I(),c.notify([{style:"inline",id:"#cc-message-center",customNotificationID:f,status:"confirm",curtain:!0,close:!1,fade:!1,header:i.t("ns.common:resources.sessionTimeoutHeader"),message:i.t("ns.common:resources.sessionTimeoutMessage"),actionOptions:[{actionOption1:[{text:i.t("ns.common:resources.okText"),action:"",classes:"btn cc-submit-changes-btn cc-btn-primary"}]}]}]),t("button","#"+f).each(function(){var e=this.onclick.bind(this);t(this).prop("onclick",null).on("click",function(){U(),T(),m&&m.focus(),e instanceof Function&&e()})}),t("#"+f).closest("div.cc-notification-outer").next("div.cc-curtain").on("click",function(){t("button","#"+f).focus()}),R())},S=function(){t("#"+f).closest("div.cc-notification-outer").next("div.cc-curtain").addBack().remove()},O=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&t("#"+f).length&&(S(),c.notify([{style:"inline",id:"#cc-message-center",customNotificationID:E,status:"confirm",curtain:!0,close:!1,fade:!1,header:i.t("ns.common:resources.sessionExpiryHeader"),message:i.t("ns.common:resources.sessionExpiryMessage"),actionOptions:[{actionOption1:[{text:i.t("ns.common:resources.okText"),action:"",classes:"btn cc-submit-changes-btn cc-btn-primary"}]}]}]),t("button","#"+E).each(function(){t(this).prop("onclick",null).on("click",function(){if(o.external&&window.idcsEnabled)window.location="sso-logout.jsp";else{var e=o.redirectToAdminLoginScreen.bind(o);o.logout(e,e)}})}),t("#"+E).closest("div.cc-notification-outer").next("div.cc-curtain").on("click",function(){t("button","#"+E).focus()}))},N=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&(g(),a=setTimeout(b,r))},g=function(){a&&(clearTimeout(a),a=null)},R=function(){o.profileType==e.PROFILE_TYPE_ADMIN&&(U(),l=setTimeout(O,e.TOKEN_EXPIRED_MESSAGE_TIMEOUT))},U=function(){l&&(clearTimeout(l),l=null)},L=function(){t("html").off(".cctimer"),o.loggedIn&&(_(),o.profileType==e.PROFILE_TYPE_ADMIN?(N(),t("html").on("keyup.cctimer mouseup.cctimer",function(){s=!0}),o.registerLoginUpdateCallback(function(){U(),S(),p()}),o.registerLogoutUpdateCallback(function(){t("button","#"+E).trigger("click")})):o.profileType==e.PROFILE_TYPE_LAYOUT_PREVIEW&&parent.$&&t("html").on("keyup.cctimer mouseup.cctimer",function(e){parent.$("html",parent.document).trigger(e)}))},h=function(){d(),g(),U(),t("html").off(".cctimer")};o.registerInitCallback(L),t.Topic(n.topicNames.AUTH_LOGIN_SUCCESS).subscribe(L),t.Topic(n.topicNames.AUTH_LOGOUT_SUCCESS).subscribe(h),t.Topic(n.topicNames.USER_LOGIN_SUCCESSFUL).subscribe(L),t.Topic(n.topicNames.USER_AUTO_LOGIN_SUCCESSFUL).subscribe(L),t.Topic(n.topicNames.USER_LOGOUT_SUCCESSFUL).subscribe(h),t.Topic(n.topicNames.USER_SESSION_EXPIRED).subscribe(h),o.profileType==e.PROFILE_TYPE_LAYOUT_PREVIEW&&t.Topic(n.topicNames.PAGE_READY).subscribe(L)}return o});
//# sourceMappingURL=cc-oauth-timeout.js.map