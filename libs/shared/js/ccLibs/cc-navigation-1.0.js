define("navigation",["jquery","crossroads","hasher","pubsub"],function(t,o,n,e){"use strict";function i(){var o,i=this,a=t.Deferred();t.Topic(e.topicNames.USER_UNAUTHORIZED).subscribe(function(t){i.loginHandlerPage=i.getPath(),a.done(function(){o(t)})}),i.setHash=function(t){n.setHash(t)},i.getHash=function(){return n.getHash()},i.setLoginHandler=function(t){o=t,a.resolve()},i.checkLogin=function(t){if(t.indexOf("?loggedIn=false")>-1){var n=t.indexOf("page=")+5,e=decodeURIComponent(t.substr(n));e.indexOf("&")>-1&&(e=e.substr(0,e.indexOf("&"))),e="/"===e.charAt(0)?e:"/"+e;var r=[{message:"success",linkToRedirect:e}];"/"==t.charAt(0)?i.loginHandlerPage=t.substr(1,t.indexOf("?")-1):i.loginHandlerPage=t.substr(0,t.indexOf("?")-1),a.done(function(){o(r)})}},i.goTo=function(o,n,a){var r=i.getPathWithLocale(o);if(n)t.Topic(e.topicNames.HISTORY_PUSH_STATE).publish(r);else if(window.history&&window.history.pushState)a?window.history.replaceState(null,"",r):window.history.pushState(null,"",r),t.Topic(e.topicNames.HISTORY_PUSH_STATE).publish(r),i.checkLogin&&i.checkLogin(o);else{var c=i.getBaseURL()+("/"===r.charAt(0)?r:"/"+r);window.location.assign(c)}},i.getPath=function(){var t=window.location.pathname;return"/"===t.charAt(0)&&(t=t.substr(1)),t},i.getRelativePath=function(){var t=window.location.pathname;return"/"!==t.charAt(0)&&(t="/"+t),t},i.isPathEqualTo=function(t){if(t){var o=i.getPathWithoutLocale(),n=i.getPathWithoutLocale(t);return o="/"===o.charAt(0)?o.substr(1):o,n="/"===n.charAt(0)?n.substr(1):n,0===o.indexOf(n)}return!1},i.getQueryString=function(){return window.location.search},i.getBaseURL=function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var t=window.siteBaseURLPath;return t&&"/"!==t?"/"===t.substr(0,1)?window.location.origin+t:window.location.origin+"/"+t:window.location.origin},i.getPathWithoutLocale=function(t){var o=t?t:window.location.pathname+window.location.search;if(window.urlLocale){var n=JSON.parse(window.urlLocale)[0].name,e=o.split("/");if(e.length>=2)for(var i=window.siteBaseURLPath,a=0;a<e.length;a++)e[a]===n?o=o.replace("/"+e[a],""):i&&"/"!==i&&(o=o.replace(i,""))}return o},i.getPathWithoutFacebookContext=function(t){var o=t?t:window.location.pathname+window.location.search;if(window.FacebookCanvas){var n=o.split("/");n.length>=2&&"facebook"==n[1]&&(o=o.replace("/"+n[1],"/wishlist"))}return o},i.getPathWithoutContext=function(t){return t=i.getPathWithoutLocale(t),t=i.getPathWithoutFacebookContext(t)},i.getPathWithLocale=function(t){var o=t?t:window.location.pathname+window.location.search;if(window.urlLocale){var n=JSON.parse(window.urlLocale)[0].name;o="/"===o.charAt(0)?o:"/"+o,o.indexOf("/"+n)===-1&&(o.indexOf("/")===-1&&(o="/"+o),o="/"+n+o)}var e=window.siteBaseURLPath;return e&&o.substr(0,e.length)!==e?e+o:o},i.getLocaleBasedUrl=function(t){var o=window.siteBaseURLPath,n=i.getPathWithoutLocale(),e="";return e="/"!==o?i.getBaseURL()+"/"+t+n.replace(o,""):i.getBaseURL()+"/"+t+n},i.doLogin=function(t,o){if(i.getPathWithoutLocale().indexOf("?loggedIn=false")<0){var n=o?o:window.location.pathname;n=n+"?loggedIn=false&page="+encodeURIComponent(t),i.goTo(n)}},i.cancelLogin=function(){i.goTo(window.location.pathname)}}return new i});
//# sourceMappingURL=cc-navigation-1.0.js.map