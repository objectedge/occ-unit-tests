define("routing",["jquery","crossroads","pubsub","ccConstants","navigation","ccNavState"],function(e,t,a,o,n,r){"use strict";function i(){function i(e,t){return e&&(e="/"===e.charAt(0)?e.substr(1):e),t&&(t="/"===t.charAt(0)?t.substr(1):t),e===t}function g(t,o,r){"/"==t&&(t="home"),t="/"===t.charAt(0)?t.substr(1):t;var c=!1;t=n.getPathWithoutLocale(t),i(u,t)&&r&&(c=!0),e.Topic(a.topicNames.PAGE_PAGINATION_CHANGE).publish({page:r,paginationOnly:c},[{message:"success"}]),o&&E.shouldDecode(t)&&(o=decodeURIComponent(o));var p={path:t,parameters:o,page:r,paginationOnly:c};c?s!==o&&e.Topic(a.topicNames.PAGE_PARAMETERS_CHANGED).publish(p):E.handleViewChanged(p),u=t,s=o,h=!0}function f(e,t,a){g(e,a,t)}function m(e){r.route(e),l[e]||(l[e]={pageNumber:t.addRoute(e+"/{pageNumber}",null,800),pageNumberParameters:t.addRoute(e+"/{pageNumber}?{parameters}",null,850)},l[e].pageNumber.matched.add(function(t){f(e,t)}),l[e].pageNumberParameters.matched.add(function(t,a){f(e,t,a)}))}function b(e,t){if("category"===e.data.page.pageId){var a=e.data.page.category.route;m(a)}}function A(){var t=window.location.pathname;if("200"===r.statusCode()&&r.pageNumber()&&r.pageNumber()>1){var i="",u=t.split("/"),s=u[u.length-1];if(s===r.pageNumber()){for(var c=0;c<u.length-1;c++)""!==u[c]&&(i=i+"/"+u[c]);m(i)}}window.location.search!=o.URL_SERVERSIDE&&(t+=window.location.search),"404"===r.statusCode()&&(t="/404"),e.Topic(a.topicNames.HISTORY_PUSH_STATE).publish(t),n.checkLogin&&n.checkLogin(t)}var E=this,N=t.parse;return t.parse=function(t,o){for(var r=t,i=!0,u=0;u<d.length;u++)if(t&&t.indexOf(d[u])!==-1){i=!1;break}i&&(r=E.uriEncodeQueryString(t));var s=n.getPath(),c={oldHash:s,newHash:r};e.Topic(a.topicNames.UPDATE_HASH_CHANGES).publish(c),r=n.getPathWithoutContext(r),N.call(this,r,o)},e.Topic(a.topicNames.HISTORY_PUSH_STATE).subscribe(E.historyPushed.bind(E)),c=t.addRoute("{path*}",null,500),c.matched.add(g),p=t.addRoute("{path*}?{parameters}",null,600),p.matched.add(g),e.Topic(a.topicNames.PAGE_LAYOUT_LOADED).subscribe(b),window.history&&window.history.pushState&&window.addEventListener("popstate",function(e){t.parse(location.pathname+location.search)}),A(),E}var u=null,s=null,c=null,p=null,d=["searchresults"],h=!1,l={};return i.prototype.uriEncodeQueryString=function(e){if(!e)return null;var t=e,a={};if(e.indexOf("?")!=-1){for(var o=e.split("?"),n=o[1].split("&"),r="",i=0;i<n.length;i++){var u=n[i].split("=");a[u[0]]=encodeURIComponent(u[1])}var s=!1;for(var c in a){var p=a[c];s&&(r+="&"),r+=c+"="+p,s=!0}t=o[0]+"?"+r}return t},i.prototype.historyPushed=function(e){t.parse(e)},i.prototype.handleViewChanged=function(t){e.Topic(a.topicNames.PAGE_VIEW_CHANGED).publish(t)},i.prototype.handleParametersChanged=function(t){e.Topic(a.topicNames.PAGE_PARAMETERS_CHANGED).publish(t)},i.prototype.shouldDecode=function(e){for(var t=!0,a=0;a<d.length;a++)if(d[a].indexOf(e)!==-1){t=!1;break}return t},i});
//# sourceMappingURL=routing-3.0.js.map