define("ccEETagProcessor",["pubsub","ccConstants","ccRestClient","jquery"],function(e,c,t,i){"use strict";function o(){}return o.prototype.excludedPages=[],o.prototype.location="",o.prototype.ccMetricsLocation="",o.prototype.configurations={},o.prototype.eeid=0,o.prototype.enabled=!0,o.prototype.tagLoaded=!1,o.prototype.metricsLoaded=!1,o.prototype.layoutId="",o.prototype.ccMetricsTracker={},o.prototype.init=function(){var o=this;o.enabled&&(o.deferred=i.Deferred(),t.request(c.ENDPOINT_GET_EE_PAGE_TAG_DATA,null,o.updateEETagDataSuccess.bind(o),o.updateEETagDataFail.bind(o)),i.Topic(e.topicNames.PAGE_READY).subscribe(function(e){""==o.location?o.deferred.done(function(){o.pageReady(e)}):o.pageReady(e)}),i.Topic(e.topicNames.PAGE_LAYOUT_LOADED).subscribe(o.setLayout.bind(o)),i.Topic(e.topicNames.PAGE_METADATA_CHANGED).subscribe(o.setLayout.bind(o)),i.Topic(e.topicNames.PAGE_VIEW_CHANGED).subscribe(o.pageChanged.bind(o)),i.Topic(e.topicNames.PAGE_CONTEXT_CHANGED).subscribe(o.pageChanged.bind(o)),i.Topic(e.topicNames.PAGE_PARAMETERS_CHANGED).subscribe(o.pageChanged.bind(o)))},o.prototype.updateEETagDataSuccess=function(e){var c=this;c.location=e.location,c.excludedPages=e.excludedPages,c.eeid=e.eeid,c.configurations=e.configurations,c.ccMetricsLocation=e.ccMetricsUrl,c.deferred.resolve()},o.prototype.updateEETagDataFail=function(c){i.Topic(e.topicNames.PAGE_READY).unsubscribe(self.pageReady.bind(self)),i.Topic(e.topicNames.PAGE_VIEW_CHANGED).unsubscribe(self.pageChanged.bind(self)),i.Topic(e.topicNames.PAGE_CONTEXT_CHANGED).unsubscribe(self.pageChanged.bind(self)),i.Topic(e.topicNames.PAGE_PARAMETERS_CHANGED).unsubscribe(self.pageChanged.bind(self)),i.Topic(e.topicNames.PAGE_LAYOUT_LOADED).unsubscribe(self.setLayout.bind(self)),i.Topic(e.topicNames.PAGE_METADATA_CHANGED).unsubscribe(self.setLayout.bind(self))},o.prototype.pageReady=function(e){var c=this;c.excludedPages.indexOf(e.pageId)==-1&&c.location&&(c.tagLoaded?window.ATGSvcs&&(ATGSvcs.setCfg&&ATGSvcs.setCfg("layoutId",c.layoutId),ATGSvcs.ee&&ATGSvcs.ee.reset()):(require([c.location],function(){if(window.ATGSvcs){window.OracleUnifiedVisit&&OracleUnifiedVisit.eeid&&ATGSvcs.setEXPID?(ATGSvcs.setEEID&&ATGSvcs.setEEID(OracleUnifiedVisit.eeid),ATGSvcs.setEXPID(c.eeid)):ATGSvcs.setEEID&&ATGSvcs.setEEID(c.eeid);for(var e in c.configurations)ATGSvcs.setCfg&&ATGSvcs.setCfg(e,c.configurations[e]);ATGSvcs.setCfg&&ATGSvcs.setCfg("layoutId",c.layoutId),ATGSvcs.ee&&ATGSvcs.ee.reset()}}),c.tagLoaded=!0)),c.excludedPages.indexOf(e.pageId)==-1&&c.ccMetricsLocation&&!c.metricsLoaded&&(require([c.ccMetricsLocation],function(e){c.ccMetricsTracker=e}),c.metricsLoaded=!0)},o.prototype.pageChanged=function(e){var c=this;"undefined"!=typeof window.ATGSvcs&&window.ATGSvcs&&c.excludedPages.indexOf(e.pageId)>-1&&(ATGSvcs.stopRules&&ATGSvcs.stopRules(),delete window.ATGSvcs,require.undef(c.location),c.tagLoaded=!1),c.ccMetricsLocation&&c.excludedPages.indexOf(e.pageId)>-1&&(c.ccMetricsTracker.ccMetricUnhook&&c.ccMetricsTracker.ccMetricUnhook(),require.undef(c.ccMetricsLocation),c.metricsLoaded=!1)},o.prototype.setLayout=function(e,c){var t=this;t.layoutId=e.layout()},new o});
//# sourceMappingURL=cc-ee-tag-processor-1.0.js.map