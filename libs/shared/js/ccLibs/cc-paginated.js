define("ccPaginated",["knockout","pubsub","navigation","crossroads","ccConstants","ccNavState"],function(t,e,a,r,i,s){"use strict";function o(){var e=this;e.active=!1,e.pageNumber=1,e.pageId=t.observable(""),e.contextId=t.observable(""),e.paginationOnly=t.observable(!1),e.seoslug=t.observable(""),e.previousHash=t.observable(""),e.currentHash=t.observable(""),e.isMobileView=t.observable(!1),e.paginationType=t.observable(0),e.targetPage=1,e.clearOnLoad=!1,e.itemsPerPage=40,e.blockSize=40,e.pageBatchSize=1,e.data=t.observableArray().extend({deferred:!0}),e.pageWindowSize=5,e.startIndex=0,e.lastIndex=e.pageWindowSize-1,e.pageIndex=0,e.middlePageOffset=0,e.focusPage=!1,e.pages=t.computed(e.pagesFunction,e),e.scrollToTop=!0,e.currentPage(1),e.firstPageIndex(1),e.totalNumber(0),e.sortDirectiveProp("displayName"),e.sortDirectiveOrder("asc"),e.totalNumberOfPages(0),e.clickedPage(-1),e.useGenericSort=!1,e.sortOptions=t.observableArray([]),e.selectedResultsPerPageOption=t.observable(),e.resultsPerPageOptions=t.observableArray([])}return o.prototype.currentPage=t.observable(0),o.prototype.totalNumber=t.observable(0),o.prototype.firstPageIndex=t.observable(1),o.prototype.data=t.observableArray([]).extend({deferred:!0}),o.prototype.sortDirectiveProp=t.observable("displayName"),o.prototype.sortDirectiveOrder=t.observable("asc"),o.prototype.totalNumberOfPages=t.observable(0),o.prototype.pageStartIndex=t.observable(),o.prototype.pageEndIndex=t.observable(),o.prototype.clickedPage=t.observable(-1),o.prototype.updatePagination=function(t){var e="";if(i.ALLOW_HASHBANG&&(e+=i.URL_HASH_SIGN+i.URL_PREPEND_HASH),1==this.paginationType())return e=s.route()+"/"+t,a.getPathWithLocale(e);if(2==this.paginationType()){var o=r.addRoute("/searchresults?{parameters}"),n="",h=!1;for(var p in this.parameters)this.parameters.hasOwnProperty(p)&&("page"==p&&(this.parameters[p]=t,h=!0),n+=p+"="+this.parameters[p]+"&");return n=n.substring(0,n.length-1),h||(n+="&page="+t),e+=o.interpolate({parameters:n}),a.getPathWithLocale(e)}if(3==this.paginationType()){e=i.AGENT_BASE_CONTEXT+"/"+i.URL_HASH_SIGN+i.URL_PREPEND_HASH;var o=r.addRoute("/{pageId}/{contextId}?{parameters}"),n="",h=!1;for(var p in this.parameters)this.parameters.hasOwnProperty(p)&&("page"==p&&(this.parameters[p]=t,h=!0),n+=p+"="+this.parameters[p]+"&");return n=n.substring(0,n.length-1),h||(n&&(n+="&"),n+="page="+t),e+=o.interpolate({pageId:this.pageId(),contextId:this.contextId(),parameters:n}),a.getPathWithLocale(e)}return""},o.prototype.load=function(t){t?(this.clearData(),this.clearOnLoad=!0):(this.clearData(),this.pageNumber&&(this.totalNumberOfPages(this.pageNumber),this.firstPageIndex(null),this.currentPage(this.pageNumber),this.firstPageIndex(1))),this.getPage(this.pageNumber||this.currentPage()||1)},o.prototype.cleanPage=function(){if(1==this.paginationType())o=s.route(),a.goTo(o);else if(2==this.paginationType()){var t=r.addRoute("/searchresults?{parameters}"),e="";for(var i in this.parameters)this.parameters.hasOwnProperty(i)&&("page"==i||(e+=i+"="+this.parameters[i]+"&"));e=e.substring(0,e.length-1),o=t.interpolate({parameters:e}),a.goTo(o)}else if(3==this.paginationType()){var t=r.addRoute("/{pageId}/{contextId}?{parameters}"),e="";for(var i in this.parameters)this.parameters.hasOwnProperty(i)&&("page"==i||(e+=i+"="+this.parameters[i]+"&"));e=e.substring(0,e.length-1);var o=t.interpolate({pageId:this.pageId(),contextId:this.contextId(),parameters:e});a.goTo(o)}},o.prototype.firstPage=function(){return this.updatePagination(this.firstPageIndex())},o.prototype.goToFirstPageControls=function(){return this.initializeIndex(),!0},o.prototype.previousPage=function(){return this.currentPage()>this.startIndex+1?this.updatePagination(this.currentPage()-1):this.updatePagination(this.currentPage())},o.prototype.goToPage=function(t){return this.updatePagination(t.pageNumber)},o.prototype.nextPage=function(){return this.currentPage()<this.totalNumberOfPages()?this.updatePagination(this.currentPage()+1):this.updatePagination(this.currentPage())},o.prototype.lastPage=function(){return this.updatePagination(this.totalNumberOfPages())},o.prototype.incrementPage=function(){this.currentPage()<this.totalNumberOfPages()&&this.getPage(this.currentPage()+1)},o.prototype.getPage=function(t){if(this.totalNumberOfPages()>1&&this.adjustPageIndex(t),this.adjustStartAndEndPageIndex(t),t!==this.currentPage()&&t!==this.targetPage&&this.isMobileView()&&$.Topic(e.topicNames.RECORD_PAGINATION_PAGE_CHANGE).publish(),t===this.targetPage&&null!==this.targetPage&&void 0!==this.targetPage||(this.targetPage=t),this.clearOnLoad)return this.fetchBlock(this.pageStartIndex()),this.clickedPage(t),void this.currentPage(t);for(var a=this.pageStartIndex();a<this.pageEndIndex();a+=1)if("undefined"==typeof this.data()[a])return t!==this.currentPage()&&(this.targetPage=t),void this.fetchBlock(this.pageStartIndex());this.currentPage(t)},o.prototype.pagesFunction=function(){var t,e,a,r,i,s,o,n,h,p=1;for(this.clearOnLoad&&this.adjustStartAndEndPageIndex(this.pageNumber),this.totalNumber()?(e=(this.totalNumber()-this.totalNumber()%this.itemsPerPage)/this.itemsPerPage,a=this.totalNumber()%this.itemsPerPage>0?1:0,t=e+a):t=0,this.prevTotalNumberOfPages=this.totalNumberOfPages(),this.totalNumberOfPages(t),this.adjustPageIndex(this.pageNumber),r=[],n=this.startIndex;n<=this.lastIndex&&n<this.totalNumberOfPages();n+=1)i=n+1,s=i===this.currentPage(),o=!!this.focusPage&&s,h=Math.abs(i-n-p),p+=1,r[h]={pageNumber:i,selected:s,focused:o};return!this.focusPage&&r.length>0&&(this.focusPage=!0),r},o.prototype.adjustPageIndex=function(t){var e=Math.floor(this.pageWindowSize/2);if(t>=this.totalNumberOfPages())t>this.totalNumberOfPages()&&(t=this.totalNumberOfPages()),t==this.totalNumberOfPages()&&(this.lastIndex=this.totalNumberOfPages()-1,this.lastIndex<this.pageWindowSize-1?this.startIndex=0:this.startIndex=this.lastIndex-(this.pageWindowSize-1));else if(t<=e)this.startIndex=0,this.totalNumberOfPages()<=this.pageWindowSize?this.lastIndex=this.totalNumberOfPages()-1:this.lastIndex=this.pageWindowSize-1;else{var a=this.totalNumberOfPages()-t;a>=e?(this.startIndex=t-1-e,this.lastIndex=t-1+e):(this.startIndex=t-1-e-a,this.lastIndex=t-1+e-a),this.startIndex<0&&(this.startIndex=0)}},o.prototype.sort=function(t){var e,a,r;this.sortDirectiveOrder(),t.order();if(!t.notReversible||this.sortDirectiveOrder()!=t.order()){for(t.maintainSortOrder&&t.maintainSortOrder===!0?a=t.order():t.id&&(a="none"===t.order()||"desc"===t.order()?"asc":"desc"),this.sortDirectiveOrder(a),e=0;e<this.sortOptions().length;e+=1)this.sortOptions()[e]===t?this.sortOptions()[e].order(a):this.sortOptions()[e].maintainSortOrder||this.sortOptions()[e].order("none");if(this.sortDirectiveProp(t.id),2==this.paginationType()||3==this.paginationType()){if(this.useGenericSort)var s=t.id+("desc"===a?"|1":"|0");else{var s="product.relevance";"listPrice"===t.id&&(s="sku.activePrice",s+="desc"===a?"|1":"|0")}this.parameters[i.SEARCH_SORT_ORDER]=encodeURIComponent(s)}if(this.data().length<this.totalNumber()||t.serverOnly)return this.clearOnLoad=!0,this.cleanPage(),this.initializeIndex(),this.targetPage=1,void this.fetchBlock(0);if($.each(this.data(),function(t,e){if(!e)return r=!0,!1}),r)return this.clearOnLoad=!0,this.targetPage=1,void this.fetchBlock(0);this.data.sort(this.sortFunction.bind(this)),this.getPage(1)}},o.prototype.sortFunction=function(t,e){var a,r,i,s,o;for(o="desc"===this.sortDirectiveOrder()?-1:1,a=this.sortDirectiveProp()&&this.sortDirectiveProp().split("."),i=t,s=e,r=0;r<a.length;r+=1)$.isArray(i)&&(i=i[0]),$.isArray(i)&&(i=i[0]),i=i&&i[a[r]],$.isArray(s)&&(s=s[0]),s=s&&s[a[r]],$.isArray(s)&&(s=s[0]);return(i===s||"string"==typeof i&&i.toLowerCase()===s.toLowerCase())&&(t.displayName&&e.displayName?(i=t.displayName&&t.displayName.toString().toLowerCase(),s=e.displayName&&e.displayName.toString().toLowerCase()):t.dateTime&&e.dateTime&&(i=t.dateTime&&t.dateTime.toLowerCase(),s=e.dateTime&&e.dateTime.toLowerCase(),o=1)),i===s?0:isFinite(i)&&isFinite(s)?(parseFloat(i)-parseFloat(s))*o:i.toString().toLowerCase()>s.toString().toLowerCase()?o:-1*o},o.prototype.adjustStartAndEndPageIndex=function(t){this.pageEndIndex(t*this.itemsPerPage),this.totalNumber()&&this.pageEndIndex()>this.totalNumber()&&this.pageEndIndex(this.totalNumber()),this.pageStartIndex((t-1)*this.itemsPerPage)},o.prototype.initializeIndex=function(){this.startIndex=0,this.lastIndex=this.pageWindowSize-1,this.clickedPage(1)},o.prototype.clearData=function(){this.data([]),this.prevTotalNumber=this.totalNumber(),this.totalNumber(null)},o.prototype.addData=function(t,e,a){var r,i,s;if(this.pageStartIndex()>0&&(e<0||e===a)?(e=this.prevTotalNumber-this.blockSize>=0?this.prevTotalNumber-this.blockSize:0,this.removeLastPage()):e=e<0?0:e,this.totalNumber(e),i=a+this.blockSize*this.pageBatchSize,i>e&&(i=e),this.clearOnLoad?(r=[],this.initializeIndex()):r=this.data(),t)for(s=0;s<t.length;s+=1)r[s+a]=t[s];this.clearOnLoad?(this.data(r),this.clearOnLoad=!1):this.data.valueHasMutated(),this.currentPage()===this.targetPage&&this.currentPage.notifySubscribers(),this.targetPage?(1==this.targetPage&&this.initializeIndex(),this.adjustStartAndEndPageIndex(this.targetPage),this.scrollToTop===!0&&$(window).scrollTop(0),this.firstPageIndex(null),this.currentPage(this.targetPage),this.firstPageIndex(1),this.scrollToTop===!0&&$(window).scrollTop(0),this.targetPage=null):i<this.pageEndIndex()&&this.pageEndIndex(i)},o.prototype.fetchBlock=function(t){throw"Function Not Implemented!"},o.prototype.removeLastPage=function(){this.clearOnLoad=!1,this.startIndex=this.startIndex-1>=0?this.startIndex-1:this.startIndex,this.getPage(this.currentPage()-1)},o.prototype.sortReset=function(){this.sortDirectiveProp("displayName"),this.sortDirectiveOrder("asc"),$.each(this.sortOptions(),function(t,e){"displayName"===e.id?e.order("asc"):e.order("none")})},o});
//# sourceMappingURL=cc-paginated.js.map