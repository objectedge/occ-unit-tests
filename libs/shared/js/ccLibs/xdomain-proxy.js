define(["jquery"],function(t){"use strict";function e(t,r,n){var a=this;a.profileType=t,a.httpPort=r||"8080",a.httpsPort=n||"8443",a.parentURL=e.getCrossDomainURL(t,e.HTTP_PROTOCOL,a.httpPort,!1),document.referrer&&e.urlProtocolOnly(document.referrer)!=e.HTTPS_PROTOCOL&&null!=window&&null!=window.parent&&window.parent.postMessage(JSON.stringify({id:e.IFRAME_INIT_COMPLETE_EVENT,success:!0,payload:null}),a.parentURL)}return e.POST="POST",e.GET="GET",e.DELETE="DELETE",e.METHOD="method",e.URL="url",e.DATA="data",e.SUCCESS="success",e.FAILURE="failure",e.HEADERS="headers",e.CONTENT_TYPE="Content-Type",e.ACCEPT="Accept",e.TEXT_PLAIN="text/plain",e.APPLICATION_JSON="application/json",e.JSON="json",e.ETAG="ETag",e.ETAG_PROPERTY="___etag___",e.LAST_PUBLISHED_TIME="LastPublishedTime",e.LAST_PUBLISHED_TIME_PROPERTY="lastPublishedTime",e.XSTATEDATA="X-OCStateData",e.STATEDATA_PROPERTY="__stateData__",e.AMPERSAND="&",e.EQUALS="=",e.DOUBLE_SLASH="//",e.SLASH="/",e.EMPTY_STRING="",e.PROTOCOL_SEP="://",e.COLON=":",e.QUESTION_MARK="?",e.SPACE=" ",e.SEMICOLON=";",e.DASH="-",e.CURLY_BRACES="{}",e.PERIOD=".",e.OAUTH_ACCESS_TOKEN_PARAM="access_token",e.LOGIN_SERVICE_PATH="/ccstoreui/v1/login/",e.ADMIN_LOGIN_SERVICE_PATH="/ccadminui/v1/mfalogin/",e.AGENT_LOGIN_SERVICE_PATH="/ccagentui/v1/login/",e.HTTP_PROTOCOL="http",e.HTTPS_PROTOCOL="https",e.HTTPS_FRAME_PATH="/https/https.html",e.HTTPS_ADMIN_FRAME_PATH="/https/httpsAdmin.html",e.GRANT_TYPE_PARAM="grant_type",e.PASSWORD_GRANT_TYPE_VALUE="password",e.USERNAME_PARAM="username",e.PASSWORD_PARAM="password",e.TOTP_CODE_PARAM="totp_code",e.SAML_GRANT_TYPE_VALUE="saml_credentials",e.SAML_RESPONSE_PARAM="saml_response",e.AUTH_HEADER_NAME="Authorization",e.AUTH_HEADER_PREFIX="Bearer ",e.PROFILE_TYPE_HEADER_NAME="X-CCProfileType",e.IFRAME_INIT_COMPLETE_EVENT="iframeInitComplete",e.ASSET_LANGUAGE_HEADER_NAME="X-CCAsset-Language",e.PRICE_LIST_GROUP_ID="X-CCPriceListGroup",e.ORGANIZATION_ID="X-CCOrganization",e.AGENT_CONTEXT="X-CCAgentContext",e.VIEWPORT_HEADER_NAME="X-CCViewport",e.SITE_ID="x-ccsite",e.VISIT_ID="X-CCVisitId",e.VISITOR_ID="X-CCVisitorId",e.prototype.init=function(){var t=this;t.targetMap={login:function(e,r,n){t.loginRequest(e.user,e.password,r,n)},auth:function(e,r,n){t.request(e.url,e.data,r,n,e.method,e.clientProps)},noauth:function(e,r,n){t.request(e.url,e.data,r,n,e.method)}};var e=function(e){var r=e.origin;if(r==t.parentURL){var n;n="string"==typeof e.data?JSON.parse(e.data):e.data;var a=n.id,A=n.target,o=n.payload,T=function(t,n){var A={};A.id=a,A.success=t,A.payload=n,e.source.postMessage(JSON.stringify(A),r)},E=function(t){T(!0,t)},s=function(t){T(!1,t)},i=t.targetMap[A];i&&i(o,E,s)}};window.addEventListener("message",e,!1)},e.prototype.loginRequest=function(t,e,r,n,a){this.mfaLoginRequest(t,e,null,r,n,a)},e.prototype.mfaLoginRequest=function(t,r,n,a,A,o){var T=this,E={};E[e.USERNAME_PARAM]=t,E[e.PASSWORD_PARAM]=r,n&&(E[e.TOTP_CODE_PARAM]=n),E[e.GRANT_TYPE_PARAM]=e.PASSWORD_GRANT_TYPE_VALUE,T.loginRequestInternal(E,a,A,o)},e.prototype.samlLoginRequest=function(t,r,n,a){var A=this,o={};o[e.SAML_RESPONSE_PARAM]=t,o[e.GRANT_TYPE_PARAM]=e.SAML_GRANT_TYPE_VALUE,A.loginRequestInternal(o,r,n,a)},e.prototype.loginRequestInternal=function(r,n,a,A){var o=this,T=e.LOGIN_SERVICE_PATH;"admin"==o.profileType||"adminUI"==o.profileType?T=e.ADMIN_LOGIN_SERVICE_PATH:"agent"!=o.profileType&&"agentUI"!=o.profileType||(T=e.AGENT_LOGIN_SERVICE_PATH);var E={};E[e.GRANT_TYPE_PARAM]=r[e.GRANT_TYPE_PARAM],r[e.GRANT_TYPE_PARAM]==e.PASSWORD_GRANT_TYPE_VALUE?(E[e.USERNAME_PARAM]=r[e.USERNAME_PARAM],E[e.PASSWORD_PARAM]=r[e.PASSWORD_PARAM],r[e.TOTP_CODE_PARAM]&&null!==r[e.TOTP_CODE_PARAM]&&(E[e.TOTP_CODE_PARAM]=r[e.TOTP_CODE_PARAM])):r[e.GRANT_TYPE_PARAM]==e.SAML_GRANT_TYPE_VALUE&&(E[e.SAML_RESPONSE_PARAM]=r[e.SAML_RESPONSE_PARAM]);var s=function(t){var e=t.data;n(e)},i=function(t){var e=t.jqXHR.responseText;e&&(e=JSON.parse(e)),a(e)},_=null,P=!1;if(A&&(P=A.suppressProfileType),o.profileType&&!P&&(_={},_[e.PROFILE_TYPE_HEADER_NAME]=o.profileType),A&&A.tokenSecret){_||(_={});var R=e.AUTH_HEADER_PREFIX+A.tokenSecret;_[e.AUTH_HEADER_NAME]=R}var u={type:e.POST,dataType:e.JSON,url:T,data:E,processData:!0,success:function(t,e,r){s({data:t,textStatus:e,jqXHR:r})},error:function(t,e,r){i({jqXHR:t,textStatus:e,errorThrown:r})}};_&&(u.headers=_),t.ajax(u)},e.prototype.request=function(r,n,a,A,o,T,E,s,i){var _=this,P=r;P=encodeURI(P);var R=o;R||(R=e.GET);var u=null;n&&(R===e.GET||R===e.DELETE?P=e.addQueryParams(P,n,!0):u=JSON.stringify(n)),i&&(P=e.addQueryParams(P,i,!0)),R===e.GET&&(P=e.fixIECaching(P));var S=function(t){var r=t.data,n=t.jqXHR.getResponseHeader(e.ETAG),A=t.jqXHR.getResponseHeader(e.XSTATEDATA);n&&r&&(n=n.replace(/["]+/g,""),r[e.ETAG_PROPERTY]=n),A&&r&&(r[e.STATEDATA_PROPERTY]=A);var o=t.jqXHR.getResponseHeader(e.LAST_PUBLISHED_TIME);r&&o&&(r[e.LAST_PUBLISHED_TIME_PROPERTY]=Number(o)),a(r)},l=function(t){var r=t.jqXHR.status,n=t.jqXHR.responseText,a=t.jqXHR.getResponseHeader(e.XSTATEDATA);if(n)try{n=JSON.parse(n)}catch(t){n={}}a&&n&&(n[e.STATEDATA_PROPERTY]=a),A(n,r)},O={dataType:e.JSON,contentType:e.APPLICATION_JSON,type:R,url:P,processData:!1,success:function(t,e,r){S({data:t,textStatus:e,jqXHR:r})},error:function(t,e,r){l({jqXHR:t,textStatus:e,errorThrown:r})},beforeSend:s},p=null,c=!1;if(T&&(c=T.suppressProfileType),_.profileType&&!c&&(p={},p[e.PROFILE_TYPE_HEADER_NAME]=_.profileType),E){p||(p={});for(var f in E)E.hasOwnProperty(f)&&(E[f]instanceof Object?p[f]=JSON.stringify(E[f]):p[f]=E[f])}if(T&&T.tokenSecret){p||(p={});var N=e.AUTH_HEADER_PREFIX+T.tokenSecret;p[e.AUTH_HEADER_NAME]=N}u&&(O.data=u),p&&(O.headers=p),t.ajax(O)},e.parseQueryParams=function(t){if(null===t)return null;for(var r=t.split(e.AMPERSAND),n={},a=0;a<r.length;a++){var A=r[a].split(e.EQUALS);n[A[0]]=A[1]}return n},e.addQueryParams=function(t,e,r){if(!t)return null;if(!e)return t;var n=Object.keys(e);if(n&&0===n.length)return t;var a=t,A=!0;a.indexOf("?")!==-1&&(A=!1);for(var o=0;o<n.length;o++){var T=n[o],E=e[n[o]];r&&(T=encodeURIComponent(T),E=encodeURIComponent(E));var s=T+"="+E,i="&";A&&(i="?",A=!1),a+=i+s}return a},e.getTimestamp=function(t){var e=new Date/1e3,r=parseInt(t,10),n=e+r;return parseInt(+n,10)},e.getCrossDomainURL=function(t,r,n,a){var A=r+e.PROTOCOL_SEP+e.urlHostnameOnly(window.location.href)+e.COLON+n;return a===!0&&("storefront"===t||"storefrontUI"==t?A+=e.HTTPS_FRAME_PATH:"admin"!==t&&"adminUI"!=t||(A+=e.HTTPS_ADMIN_FRAME_PATH)),A},e.convertUrl=function(t){if(null!=t&&t.charAt(0)!=e.SLASH)return[t];var r=e.urlPathPortionOnly(t),n=r.split(e.SLASH);if(1==n.length)return[e.SLASH];n[0]||(n=n.slice(1));var a=new Array(n.length+1);a[0]=e.SLASH,a[1]=n[0];for(var A=1;A<n.length;A++)a[A+1]=e.SLASH+n[A];return a},e.urlNoProtocolOrQueryParams=function(t){if(null==t)return null;var r=t.split(e.QUESTION_MARK),n=null;return n=r.length>1?r[0]:t,r=n.split(e.PROTOCOL_SEP),r.length>1&&(n=r[1]),n},e.urlPathPortionOnly=function(t){var r=e.urlNoProtocolOrQueryParams(t);return r.substring(0,1)!==e.SLASH&&(r=e.removeBeforeFirstSlash(r)),r},e.urlHostnamePortPortionOnly=function(t){var r=e.urlNoProtocolOrQueryParams(t);if(r.substring(0,1)==e.SLASH)return null;var n=r.split(e.SLASH);return n[0]},e.urlHostnameOnly=function(t){var r=e.urlHostnamePortPortionOnly(t),n=r.split(e.COLON);return n[0]},e.urlProtocolOnly=function(t){var r=t.split(e.PROTOCOL_SEP);return r[0]},e.removeBeforeFirstSlash=function(t){var r=t.split(e.SLASH),n=t.substring(r[0].length);return n},e.fixIECaching=function(t){return t},e.insertAuthHeadersAsQueryParams=function(t,e,r){return uri},e.parseClaimsFromAccessToken=function(t){if(!t)return null;var r=t.split(e.PERIOD),n=r[1],a=e.decodeBase64(n),A=JSON.parse(a);return A},e.decodeBase64=function(t){var e,r,n,a,A={},o=0,T=0,E="",s=String.fromCharCode,i=t.length,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(e=0;e<64;e++)A[_.charAt(e)]=e;for(n=0;n<i;n++)for(r=A[t.charAt(n)],o=(o<<6)+r,T+=6;T>=8;)((a=o>>>(T-=8)&255)||n<i-2)&&(E+=s(a));return E},e});
//# sourceMappingURL=xdomain-proxy.js.map