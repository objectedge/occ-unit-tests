define("ccImageZoom",["spinner"],function(e){"use strict";function t(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}}(),window.cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},this.framesPerSecond=60,this.spinner=e,this.usingSpinner=!0,this.spinnerDelay=200,this.zoomDelay=800,this.smallImageClass="ccz-small",this.magnifierClass="ccz-magnifier",this.fullImageClass="ccz-full",this.flyoutClass="ccz-flyout",this.magnifierPercent=.45,this.flyoutSpacing=0,this.element=null,this.flyout=null,this.flyoutEnabled=!0,this.flyoutScaling=.8,this.magnifierEnabled=!1,this.magnifierPercentEased=.25,this.smallImageUrl=null,this.smallImageUrls=null,this.fullImageUrl=null,this.fullImageUrls=null,this.errorImageUrl=null,this.imageMetadataDefault=null,this.imageMetadatas=[],this.fullImage=null,this.smallIamge=null,this.jqBackgroundImage=null,this.loading=!1,this.magnifierMin=.1,this.magnifierMax=.9,this.magnifierVelocity=.02,this.dampingFactor=12,this.magnifierBorderWidth=2,this.zoomCurtainClassName="ccz-zoom-curtain",this.magnifierBackgroundClassName="ccz-magnifier-background",this.lastTouchDistance=0,this.currentMx=0,this.currentMy=0,this.xp=0,this.yp=0,this.offsetMagnifier=!1,this.replaceImageAtIndex=!0;var t=this;this.handleMouseWheel=function(e){e=window.event||e,e.preventDefault&&e.preventDefault();var a=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail||e.deltaY)),i=Math.max(t.magnifierMin,Math.min(t.magnifierMax,t.magnifierPercent+t.magnifierVelocity*a));return t.magnifierPercent=i,!1},this.handleMouseMove=function(e){if(!t.loading){if(t.imageLoadFailed||t.fullImageUrl.indexOf(t.errorImageUrl)!=-1)return;if(e.preventDefault(),0===e.type.indexOf("touch")){var n=e.touches||e.originalEvent.touches;if(n.length>1){var o=Math.sqrt((n[0].pageX-n[1].pageX)*(n[0].pageX-n[1].pageX)+(n[0].pageY-n[1].pageY)*(n[0].pageY-n[1].pageY));t.lastTouchDistance=o}a=n[0].pageX,i=n[0].pageY}else a=e.pageX||a,i=e.pageY||i;t.magnify_offset||(t.magnify_offset=$(t.element).offset());var l=a-t.magnify_offset.left,r=i-t.magnify_offset.top;if(t.magnifierEnabled)t.currentMx=l,t.currentMy=r;else{var s=t.jqSmallImage.width(),m=t.jqSmallImage.height(),u=t.getMagnifierWidth(),g=t.getMagnifierHeight(),d=s-u/2,f=u/2,c=m-g/2,h=g/2;t.currentMx=t.constrainValue(f,d,l),t.currentMy=t.constrainValue(h,c,r)}(l>Math.round($(this).width())||r>Math.round($(this).height())||l<0||r<0)&&t.handleMouseLeave()}},this.handleMouseLeave=function(){var e=this;clearTimeout(e.zoomTimeout),e.cancelRedraw(e),$("."+e.zoomCurtainClassName).hide(),$("."+e.magnifierBackgroundClassName).hide(),$(e.element).css({cursor:"auto"}),e.jqMagnifier.fadeOut(100),e.flyoutEnabled&&e.jqFlyout.fadeOut(100)},this.isIE=function(){return!(!navigator.userAgent.match(/Trident/)&&!navigator.userAgent.match(/Edge/))},this.handleMouseEnter=function(){var e=this;e.loading||(void 0==e.jqFlyout.find("img").attr("src")&&(e.jqFlyout.find("img").attr("src",e.fullImageUrl),$.when(e.loadImage(e.fullImageUrl)).done(function(t){e.jqFullImage.attr("src",t.src)}).fail(function(t){e.imageLoadFailed=!0,e.jqFullImage.attr("src",e.errorImageUrl)})),e.magnify_offset=$(e.element).offset(),e.fullImageUrl.indexOf(e.errorImageUrl)!=-1||e.imageLoadFailed||(e.zoomTimeout=setTimeout(function(){e.magnify_offset=$(e.element).offset(),e.isIE()?$(e.element).css({cursor:"pointer"}):$(e.element).css({cursor:"zoom-in"}),e.magnifierBackgroundImage(),e.jqZoomCurtain?e.jqZoomCurtain.fadeIn(100):e.jqZoomCurtain=e.addCurtain(e.element),e.flyoutEnabled&&e.setFlyoutSizeAndPosition(),e.jqMagnifier.fadeIn(500),e.flyoutEnabled&&e.jqFlyout.fadeIn(500),e.timeoutid=e.scheduleRedraw(e)},e.zoomDelay)))}}var a,i;return t.prototype.registerMouseWheel=function(e){var t=this,a=t.jqMagnifier[0],i="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.addEventListener?a.addEventListener(i,t.handleMouseWheel,!1):a.attachEvent("onmousewheel",t.handleMouseWheel)},t.prototype.getMagnifierWidth=function(){var e=this,t=e.getFlyoutDimensions(),a=t.width*e.magnifierPercentEased;return a},t.prototype.getMagnifierHeight=function(){var e=this,t=e.getFlyoutDimensions(),a=t.width*e.magnifierPercentEased,i=e.flyoutEnabled?t.height*e.magnifierPercentEased:a;return i},t.prototype.getPositionMagnifierCss=function(){var e=this,t=e.jqSmallImage.width(),a=e.jqSmallImage.height(),i=e.getMagnifierWidth(),n=e.getMagnifierHeight(),o=e.offsetMagnifier?1:2,l=e.offsetMagnifier?25:0,r=e.currentMx+2*l-i/o,s=e.currentMy-l-n/o,m=e.currentMx/t,u=e.currentMy/a;e.magnifierEnabled||(r=e.constrainValue(e.magnifierBorderWidth,t-i,r),s=e.constrainValue(e.magnifierBorderWidth,a-n,s));var g=r*-1,d=s*-1;e.magnifierEnabled&&(g=(m*e.jqBackgroundImage.width()-i/2)*-1,d=(u*e.jqBackgroundImage.height()-n/2)*-1);return{css:{width:i,height:n,left:r-e.magnifierBorderWidth,top:s-e.magnifierBorderWidth},background:{left:g,top:d}}},t.prototype.getPositionFlyoutCss=function(){var e=this,t=(e.getFlyoutDimensions(),e.jqSmallImage.width()),a=e.jqSmallImage.height(),i=t/e.magnifierPercentEased,n=a/e.magnifierPercentEased,o=e.xp/t,l=e.yp/a,r=o*i-e.jqFlyout.width()/2,s=l*n-e.jqFlyout.height()/2;return e.magnifierEnabled||(r=e.constrainValue(0,i-e.jqFlyout.width(),r),s=e.constrainValue(0,n-e.jqFlyout.height(),s)),{left:-r,top:-s,width:i,height:n}},t.prototype.positionMagnifier=function(){var e=this,t=e.getPositionMagnifierCss();e.jqMagnifier.css(t.css),$("."+e.magnifierBackgroundClassName).css(t.background)},t.prototype.positionFlyout=function(){var e=this,t=e.getPositionFlyoutCss();e.jqFullImage.css(t)},t.prototype.getFlyoutDimensions=function(){var e=this,t=e.jqSmallImage.width()*e.flyoutScaling,a=e.jqSmallImage.height()*e.flyoutScaling;return{width:t,height:a}},t.prototype.setFlyoutSizeAndPosition=function(){var e=this,t=e.getFlyoutDimensions(),a=e.jqSmallImage.width()+e.flyoutSpacing+"px";e.jqFlyout.css({width:t.width,height:t.height,top:"0px",left:a})},t.prototype.magnifierBackgroundImage=function(){var e=this,t=e.magnifierEnabled?e.fullImageUrl:e.smallImageUrl;if(null!==e.jqBackgroundImage)return e.jqBackgroundImage.attr("src")!=t&&$(e.jqBackgroundImage).attr("src",t),e.jqBackgroundImage.css({width:e.jqSmallImage.width(),height:e.jqSmallImage.height()}),void e.jqBackgroundImage.show();var a=$("<img class='"+e.magnifierBackgroundClassName+"'/>");e.magnifierEnabled?a.css({position:"absolute"}):a.css({position:"absolute","max-height":"none","max-width":"none",width:e.jqSmallImage.width(),height:e.jqSmallImage.height()}),$(a).attr("src",t),e.jqBackgroundImage=a,e.jqMagnifier.append(a)},t.prototype.addCurtain=function(e){var t=this,a=$("<div class='"+t.zoomCurtainClassName+"'></div>");return a.css({display:"block",position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgb(255,255,255)",opacity:0}),$(t.element).append(a),a.animate({opacity:.25},100),a},t.prototype.loadImage=function(e){var t=function(t){function a(){o.onload=null,o.onerror=null,o.onabort=null}function i(){a(),t.resolve(o)}function n(){a(),t.reject(o)}var o=new Image;o.src=e,o.onload=i,o.onerror=n,o.onabort=n};return $.Deferred(t).promise()},t.prototype.constrainValue=function(e,t,a){return Math.max(e,Math.min(t,a))},t.prototype.cancelRedraw=function(e){cancelAnimFrame(e.timeoutid)},t.prototype.scheduleRedraw=function(e){e.timeoutid&&e.cancelRedraw(e),function t(){e.timeoutid=requestAnimFrame(t),e.xp+=(e.currentMx-e.xp)/e.dampingFactor,e.yp+=(e.currentMy-e.yp)/e.dampingFactor,e.magnifierPercentEased+=(e.magnifierPercent-e.magnifierPercentEased)/e.dampingFactor,e.flyoutEnabled&&e.positionFlyout(),e.positionMagnifier()}()},t.prototype.presentImageAtIndex=function(e){var t,a=this;a.smallImageUrl=a.smallImageUrls()[e],a.fullImageUrl=a.fullImageUrls()[e];var i={alttext:a.smallImageUrl,title:a.smallImageUrl};i=$.extend(i,a.imageMetadataDefault,a.imageMetadatas[e]),a.imageLoadFailed=!1,a.loading=!0,a.jqSmallImage.fadeTo(200,0,function(){a.jqFlyout.find("img").removeAttr("src"),a.usingSpinner&&(t=setTimeout(function(){a.spinner.create({parent:a.element})},a.spinnerDelay)),a.replaceImageAtIndex&&(a.jqSmallImage.attr("src",a.smallImageUrl),a.jqSmallImage.attr("alt",i.altText),a.jqSmallImage.attr("title",i.titleText)),a.jqFullImage.attr("title",i.titleText),a.jqFullImage.attr("alt",i.altText),$.when(a.loadImage(a.smallImageUrl)).done(function(e){a.jqSmallImage.fadeTo(200,1)}).fail(function(e){a.imageLoadFailed=!0,a.jqSmallImage.fadeTo(200,1),a.jqSmallImage.attr("src",a.errorImageUrl)}).always(function(){a.usingSpinner&&(a.loading=!1,clearTimeout(t),a.spinner.destroyAndClearTimeout())})})},t.prototype.start=function(){var e=this,t="10px";if(e.imageLoadFailed=!1,e.jqSmallImage=$(e.element).find("."+e.smallImageClass),e.jqFullImage=$(e.element).find("."+e.fullImageClass),e.jqFlyout=$(e.element).find("."+e.flyoutClass),e.jqMagnifier=$(e.element).find("."+e.magnifierClass),e.jqMagnifier.length||(e.jqMagnifier=$("<div></div>"),e.jqMagnifier.addClass(e.magnifierClass),$(e.element).append(e.jqMagnifier)),!e.jqFlyout.length&&e.flyoutEnabled){e.jqFlyout=$("<div></div>"),e.jqFlyout.css({display:"none"}),e.jqFlyout.addClass(e.flyoutClass);var a=$("<img></img>");a.css({"max-width":"none"}),a.addClass(e.fullImageClass),a.on("error",function(){e.imageLoadFailed=!0}),e.jqFlyout.append(a),e.jqFullImage=a,$(e.element).append(e.jqFlyout)}if(e.index&&(e.subHandle=e.index.subscribe(function(t){e.presentImageAtIndex(t)}),$(e.element).on("remove",function(){e.subHandle&&e.subHandle.dispose()})),e.flyoutEnabled||(t="100%"),e.element){e.registerMouseWheel(),$(e.element).css({position:"relative",display:"inline-block"}),e.jqFullImage.css({position:"absolute"}),e.jqSmallImage.css({display:"block","-webkit-touch-callout":"none"});var i={background:"#DDD",border:"1px solid #FFF","box-shadow":"0 0 15px rgba(0,0,0,0.5)",display:"none",overflow:"hidden",position:"absolute","z-index":"99"};e.jqFlyout.css(i);var n=e.magnifierBorderWidth+"px solid rgb(125,125,125)",o={position:"absolute","border-radius":t,display:"none","z-index":"98",overflow:"hidden","background-repeat":"no-repeat",border:n};e.jqMagnifier.css(o);var l=e.element;$(l).bind("touchstart",function(t){t.preventDefault(),e.magnifierEnabled&&(e.offsetMagnifier=!0),e.handleMouseEnter(),e.handleMouseMove(t)}),$(l).bind("touchend",function(t){e.handleMouseLeave(),e.offsetMagnifier=!1}),$(l).bind("touchmove",e.handleMouseMove),$(l).mousemove(e.handleMouseMove),$(l).mouseenter(function(){e.handleMouseEnter()}),$(l).mouseleave(function(){e.handleMouseLeave()})}},t});
//# sourceMappingURL=cc-image-zoom-2.0.js.map