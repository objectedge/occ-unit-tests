define("pageLayout/site",["knockout","ccRestClient","ccConstants","jquery","storageApi","pageViewTracker","pageLayout/currency"],function(e,r,i,n,t,o,c){"use strict";function a(t,o,s){if(a.singleInstance)throw new Error("Cannot instantiate more than one SiteViewModel, use getInstance(pAdapter, data, pParams)");var u=this;u.currencyViewModel=c.getInstance(),u.selectedPriceListGroup=e.observable(o?o.priceListGroup.defaultPriceListGroup:null),u.activePriceListGroups=e.observableArray([]),u.siteSecondaryCurrency=e.observable(null),u.siteSecondaryCurrencyCode=null,u.priceListGroupDeferred=n.Deferred(),u.selectedPriceListGroup()&&u.priceListGroupDeferred.resolve(),u.exchangeRate=e.observable(null),u.payShippingInSecondaryCurrency=e.observable(!1),u.payTaxInSecondaryCurrency=e.observable(!1),u.siteLoadedDeferred=n.Deferred(),u.siteSecondaryInfoLoaded=n.Deferred();var d="/img/no-image.jpg";return o&&o.siteInfo&&o.siteInfo.noimage&&(d=o.siteInfo.noimage),u.getCurrency=function(e){return u.currencyViewModel.currencyMap[e]},u.setSiteSecondaryCurrency=function(){u.siteSecondaryCurrency(u.getCurrency(u.siteSecondaryCurrencyCode))},n.when(u.currencyViewModel.siteCurrenciesLoaded,u.siteSecondaryInfoLoaded).done(function(){u.setSiteSecondaryCurrency(),u.siteLoadedDeferred.resolve()}),u.noImageSrc=e.observable(d),null!=o&&r.request(i.ENDPOINT_SITES_GET_SITE,{},function(e){u.siteSecondaryCurrencyCode=e.secondaryCurrency,u.exchangeRate(e.exchangeRate?e.exchangeRate:null),u.payShippingInSecondaryCurrency(!!e.payShippingInSecondaryCurrency&&e.payShippingInSecondaryCurrency),u.payTaxInSecondaryCurrency(!!e.payTaxInSecondaryCurrency&&e.payTaxInSecondaryCurrency),u.siteSecondaryInfoLoaded.resolve()},function(e){console.log("site failed")},o.siteInfo.id),u.updateSiteSecondaryCurrencyCode=function(e){e&&e!=u.siteSecondaryCurrencyCode&&(u.siteSecondaryCurrencyCode=e,u.setSiteSecondaryCurrency())},u}return a.prototype.getCurrentLocale=function(){var e=r.getStoredValue(i.LOCAL_STORAGE_USER_CONTENT_LOCALE);return null!=e?JSON.parse(e)[0].name:n(":root").attr("lang")},a.prototype.setContextData=function(e){var n=this;for(var t in e)n[t]=e[t];if(n.selectedPriceListGroup()||e.priceListGroup){for(var o=!1,c=JSON.parse(r.getStoredValue(i.LOCAL_STORAGE_PRICELISTGROUP_ID)),a=0;a<n.priceListGroup.activePriceListGroups.length;a++)if(c&&c==n.priceListGroup.activePriceListGroups[a].id){n.selectedPriceListGroup(n.priceListGroup.activePriceListGroups[a]),o=!0;break}e.priceListGroup&&!o&&n.selectedPriceListGroup(e.priceListGroup.defaultPriceListGroup),"pending"===n.priceListGroupDeferred.state()&&n.priceListGroupDeferred.resolve()}e.priceListGroup&&n.activePriceListGroups(e.priceListGroup.activePriceListGroups),e&&e.hasOwnProperty("siteInfo")&&e.siteInfo.hasOwnProperty("noimage")&&n.noImageSrc(e.siteInfo.noimage?e.siteInfo.noimage:"/img/no-image.jpg")},a.initializeVisitorService=function(e){e&&e.visitorServiceHost&&e.tenantId&&e.oracleUnifiedVisitHost&&(window.OracleUnifiedVisit={accountId:e.tenantId+"_"+e.siteInfo.id,host:e.visitorServiceHost,handle:function(){window.ATGSvcs&&ATGSvcs.visitIDsLoaded&&ATGSvcs.visitIDsLoaded(),t.getInstance().setItem(i.VISITOR_ID,window.OracleUnifiedVisit.visitorId()),t.getInstance().setItem(i.VISIT_ID,window.OracleUnifiedVisit.visitId()),o.handleVisitDetails()}},require([e.oracleUnifiedVisitHost]))},a.getInstance=function(e,r,i){return a.singleInstance||(a.singleInstance=new a(e,r,i),a.initializeVisitorService(r)),r&&a.singleInstance.setContextData(r),a.singleInstance},a});
//# sourceMappingURL=site.js.map