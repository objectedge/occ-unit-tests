/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","promise"],function(a,f){a.$r={};a.$r.hc={viewPath:"text!views/",viewSuffix:".html",modelPath:"viewModels/",initializeMethod:"initialize",disposeMethod:"dispose",activatedHandler:"handleActivated",attachedHandler:"handleAttached",detachedHandler:"handleDetached",bindingsAppliedHandler:"handleBindingsApplied",deactivatedHandler:"handleDeactivated",transitionCompletedHandler:"handleTransitionCompleted"};o_("ModuleBinding.defaults",a.$r.hc,a);(function(){function b(b,
d,e,g,h,k,l){var n=d.canAnimate;if(null==n||n.call(d,b)){var p,s;if(n=d.prepareAnimation.call(d,b))p=n.newViewParent,s=n.oldViewParent;var C=p||e;s&&s!==e?c(g,s):C===e&&k(null);C!==e&&f.virtualElements.setDomNodeChildren(C,[]);h(C);var r=Array.prototype.slice.call(C.childNodes),E=!1,B=function(){E||(E=!0,e!==C&&m(e,r))},z=k.bind(null,s);b.newViewParent=p;b.oldViewParent=s;b.oldViewNodes=g;b.removeOldView=z;b.insertNewView=B;var J=function(){z();B();l()};return d.animate.call(d,b).then(J,function(){J();
a.q.error("ojModule animation promise was rejected")})}}function d(b,a,c){a=a||b;var d=[];c&&b===a&&(c.parentNode.removeChild(c),d.push(c));f.virtualElements.setDomNodeChildren(a,d)}function c(b,a){b.forEach(function(b){a.appendChild(b)})}function e(b,a,c){if(b&&b[a]){var d={element:c[0],valueAccessor:c[1]};2<c.length&&(d.viewModel=c[2],3<c.length&&(d["boolean"===typeof c[3]?"fromCache":"cachedNodes"]=c[3]));return f.ignoreDependencies(b[a],b,[d])}}function g(b,c,d){if(null!=b&&(c=a.$r.hc[c],null!=
c&&b&&(c=b[c],"function"===typeof c))){var e=void 0;d&&(e={element:d[0],valueAccessor:d[1]},2<d.length&&(e["boolean"===typeof d[2]?"fromCache":"cachedNodes"]=d[2]));return f.ignoreDependencies(c,b,[e])}}function h(b,a,c){var d=[];for(b=f.virtualElements.firstChild(b);null!=b&&b!=c;b=b.nextSibling)b!=a&&d.push(b);return d}function k(b,a){var c=[],d=f.virtualElements.firstChild(b);l(d,a,function(b){c.push(b)});return c}function l(b,a,c){for(;null!=b;){var d=f.virtualElements.nextSibling(b),e=b.nodeType;
b===a||1!==e&&8!==e||c(b);b=d}}function m(b,a){for(var c=a.length-1;0<=c;c--)f.virtualElements.prepend(b,a[c])}function n(b,c){if(null!=a.Components)for(var d=0;d<b.length;d++)c?a.Components.Vm(b[d]):a.Components.jp(b[d])}function p(b){if("string"===typeof b)b=f.utils.parseHtmlFragment(b);else if(window.DocumentFragment?b instanceof DocumentFragment:b&&11===b.nodeType)b=f.utils.arrayPushAll([],b.childNodes);else if(Array.isArray(b))b=f.utils.arrayPushAll([],b);else throw"The View ("+b+") has an unsupported type";
return b}function r(b){return new Promise(function(a){require([b],function(b){a(b)},function(){throw Error("ojModule failed to load "+b);})})}function s(b){return b?new Promise(function(a){b.then(a,a)}):b}f.bindingHandlers.ojModule={init:function(q,t,v,x,u){function w(b){if(b!=H)throw Error("Promise cancelled because ojModule is fetching new View and ViewModel");}function y(b){g(b,"disposeMethod",[q,t])}var F,I,G={},C,H=-1,E,B;f.utils.domNodeDisposal.addDisposeCallback(q,function(){y(F);for(var b=
Object.keys(G),a=0;a<b.length;a++)y(G[b[a]].$o)});8===q.nodeType&&(f.virtualElements.setDomNodeChildren(q,[]),B=q.nextSibling);f.computed(function(){H++;var v=0===H,x=f.utils.unwrapObservable,A=x(t()),P,Q,L,K,D,N,O,W;"string"===typeof A?P=A:(P=x(A.name),Q=x(A.viewName),L=x(A.params),K=x(A.viewModelFactory),D=x(A.createViewFunction),N=x(A.cacheKey),O=x(A.lifecycleListener),W=x(A.animation));var x=e(O,"activated",[q,t]),M,V,Z=null==N?null:G[N];if(null!=Z)delete G[N],M=Promise.resolve(Z.view),V=Promise.resolve(Z.$o);
else if(null!=K&&(V=f.ignoreDependencies(K.createViewModel,K,[L,t])),null==V&&null!=P&&(V=r(a.$r.hc.modelPath+P)),null!=V&&(V=V.then(function(b,a){w(b);return a="function"===typeof a?new a(L):g(a,"initializeMethod",[q,t])||a}.bind(null,H)),null!=D&&(M=V.then(function(b,a){w(b);if(null==a)throw"createViewFunction option cannot be used when the ViewModel is null";var c=a[D];if(null==c)throw"function specified by the createViewFunction option was not found on the ViewModel";return c.call(a)}.bind(null,
H)))),null==M)if(Q=null==Q?P:Q,null!=Q)M=r(a.$r.hc.viewPath+Q+a.$r.hc.viewSuffix);else throw Error("View name must be specified");if(null==M)throw Error("ojModule is missing a View");var X;null!=V&&(X=V.then(function(b,a){w(b);return g(a,"activatedHandler",[q,t])}.bind(null,H)));Promise.all([M,V,x,X,I]).then(function(a,x){if(a==H){var w=x[0];if(null==w)throw"The module's View was resolved to null";var r=p(w),A=x[1],D=!1,J,Q=h(q,E,B),K=k(q,E);null!=C&&(D=!0,J=Q,E||(E=document.createElement("div"),
E.className="oj-helper-module-cache",f.virtualElements.prepend(q,E)));var M=!1,w=function(b){M||(M=!0,D?c(Q,E):K.forEach(function(b){f.cleanNode(b)}),d(q,b||q,E),v||(e(O,"detached",[q,t,F,J]),g(F,"detachedHandler",[q,t,J]),e(O,"deactivated",[q,t,F]),g(F,"deactivatedHandler",[q,t])),D?(n(J,!1),G[C]={$o:F,view:J}):y(F),F=A,C=N)},P=function(b){b=b||q;m(b,r);var a=null!=Z;a&&n(r,!0);e(O,"attached",[b,t,A,a]);g(A,"attachedHandler",[b,t,a]);if(!a){var c=u.createChildContext(A,void 0,function(b){b.$module=
A;b.$params=L});l(r[0],E,function(b){f.applyBindings(c,b)});e(O,"bindingsApplied",[b,t,A]);g(A,"bindingsAppliedHandler",[b,t])}},ga=function(){e(O,"transitionCompleted",[q,t,A]);g(A,"transitionCompletedHandler",[q,t])};if(null!=W){var ja=b({node:q,valueAccessor:t,isInitial:v,oldViewModel:F,newViewModel:A},W,q,Q,P,w,ga);I=s(ja)}else I=void 0;I||(w(null),P(null),ga())}}.bind(null,H),function(b,c){b==H&&null!=c&&a.q.error(c)}.bind(null,H))},null,{disposeWhenNodeIsRemoved:q});return{controlsDescendantBindings:!0}}};
f.virtualElements.allowedBindings.ojModule=!0})()});